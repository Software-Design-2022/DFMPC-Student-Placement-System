<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Screens/EmergencyPage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Screens/EmergencyPage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as Device from "expo-device";
import * as Notifications from "expo-notifications";
import React, { useState, useEffect, useRef } from "react";
import {
  Text,
  View,
  Button,
  SafeAreaView,
  StyleSheet,
  Image,
  TextInput,
  Alert,
  LogBox,
} from "react-native";
import "./global";
import { firebase } from "../firebase";
import { useNavigation } from "@react-navigation/core";
import { createTopBar } from "../HelperFunctions";
import { Modal } from "react-native-paper";
import {
  schedulePushNotification,
  EventNotification,
} from "./SendNotification";
import * as Permissions from "expo-permissions";
import * as Location from "expo-location";

const authname = authName;
const authlastName = authLastName;

const msg = {
  // message to be sent to the user
  title: "Message", // (optional)
  body: "Emergency Message Has Been Sent", // (required)
  data: { data: "goes here" }, // (optional) any data that is sent is stored in the push notification
};
const sendToFirestore = (text, msg) => {
  // send message to firestore
  firebase // firebase
    .firestore() // firestore
    .collection("panic_button") // collection
    .add({
      // add
      Location: JSON.stringify(location), // new firestore geopoint with latitude and longitude means
      query: text, // query
      student_Number: "123456", // student number
      user_FirstName: authname, // user first name
      user_LastName: authlastName, // user last name
    })
    .then(() => {
      Alert.alert("Emergency Message Saved"); // alert
      schedulePushNotification(msg, "Emergency Page"); // send notification
    });
};

/**
 * @module EmergencyPage
 * @returns Screen that displays the emergency page for the user to fill in about the emergency in order to receive help.
 * @returns {JSX.Element} Screen that displays the emergency page
 */
export default function EmergencyPage() {
  // emergency page
  const [text, setText] = useState(""); // text
  const navigation = useNavigation(); // navigation
  const [expoPushToken, setExpoPushToken] = useState(""); // expo push token
  const [notification, setNotification] = useState(false); // notification
  const notificationListener = useRef(); // notification listener
  const responseListener = useRef(); // response listener
  const modalVisible = false; // modal visible
  LogBox.ignoreLogs(["Setting a timer"]); // ignore logs

  return (
    // return
    &lt;View style={styles.container}>
      &lt;View
        //create background image
        style={{ position: "absolute" }}
      >
        &lt;Image
          resizeMode="contain"
          source={require("./images/background.png")}
          blurRadius={0}
        />
      &lt;/View>
      &lt;View
        //create top bar
        style={{ flex: 1 }}
      >
        {createTopBar(10, navigation)}

        &lt;View style={{ padding: 10, marginBottom: 20, top: 60 }}>
          &lt;TextInput
            // user can type their emergency message
            style={styles.message}
            placeholder="Type emergency message here!" // placeholder
            onChangeText={(newText) => setText(newText)} // on change text
            defaultValue={text} // default value
          />
        &lt;/View>

        &lt;View style={{ margin: 20, top: 60 }}>
          &lt;Button
            title="Send Emergency message"
            color="#415A77"
            // when clicked data is send to firestore database
            onPress={() => {
              sendToFirestore(text, msg), setText("");
            }} // on press
          />
        &lt;/View>
      &lt;/View>
    &lt;/View>
  );
}

async function getLocationAsync() {
  let { status } = await Permissions.askAsync(Permissions.LOCATION_FOREGROUND); // ask for location permission
  if (status !== "granted") {
    setErrorMsg("Permission to access location was denied");
  }

  let location = await Location.getCurrentPositionAsync({}); // get current location
  return location;
}

const location = getLocationAsync(); // call getLocationAsync function and store the result in location variable

const styles = StyleSheet.create({
  container: {
    top: 0,
    flex: 1,
    justifyContent: "center",
    backgroundColor: "rgba(192,192,192,0.3)",
  },
  message: {
    marginTop: 50,
    marginBottom: 20,
    marginRight: 5,
    marginLeft: 5,
    height: 200,
    textAlign: "center",
    borderRadius: 5,
    backgroundColor: "white",
  },

  Button1: {
    backgroundColor: "rgba(221, 240, 255,0.2)",
  },

  title: {
    textAlign: "center",
    marginVertical: 8,
  },
  fixToText: {
    flexDirection: "row",
    justifyContent: "space-between",
  },
  map: {
    position: "absolute",
    top: 0,
    left: 0,
    bottom: 0,
    right: 0,
  },
  MapStyle: {
    flex: 1,
    margin: 20,
    marginBottom: 90,

    justifyContent: "center",
  },
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-App%2520-%2520The%2520Main%2520App%2520Component.html">App - The Main App Component</a></li><li><a href="module-CalendarView.html">CalendarView</a></li><li><a href="module-Dashboard.html">Dashboard</a></li><li><a href="module-DayAgenda.html">DayAgenda</a></li><li><a href="module-EmergencyPage.html">EmergencyPage</a></li><li><a href="module-EmergencyProtocols.html">EmergencyProtocols</a></li><li><a href="module-EventsCalendar.html">EventsCalendar</a></li><li><a href="module-Feedback.html">Feedback</a></li><li><a href="module-GlobalVariables%2520-%2520The%2520Global%2520Variables%2520Component.html">GlobalVariables - The Global Variables Component</a></li><li><a href="module-LoginMicrosoft.html">LoginMicrosoft</a></li></ul><h3>Classes</h3><ul><li><a href="Screens.LoginMicrosoft.html">LoginMicrosoft</a></li><li><a href="TwitterFeed.html">TwitterFeed</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AnimatedPressable">AnimatedPressable</a></li><li><a href="global.html#AnimatedTouchable">AnimatedTouchable</a></li><li><a href="global.html#authEmail">authEmail</a></li><li><a href="global.html#authLastName">authLastName</a></li><li><a href="global.html#authName">authName</a></li><li><a href="global.html#authUser">authUser</a></li><li><a href="global.html#authUserProfilePic">authUserProfilePic</a></li><li><a href="global.html#authUserRef">authUserRef</a></li><li><a href="global.html#AVATAR_SIZE">AVATAR_SIZE</a></li><li><a href="global.html#compare">compare</a></li><li><a href="global.html#DATA">DATA</a></li><li><a href="global.html#DATA2">DATA2</a></li><li><a href="global.html#defaultProfilePic">defaultProfilePic</a></li><li><a href="global.html#doctorsList">doctorsList</a></li><li><a href="global.html#eventData">eventData</a></li><li><a href="global.html#EventNotification">EventNotification</a></li><li><a href="global.html#eventsData">eventsData</a></li><li><a href="global.html#generateColor">generateColor</a></li><li><a href="global.html#ICON_SIZE">ICON_SIZE</a></li><li><a href="global.html#initialDate">initialDate</a></li><li><a href="global.html#Item">Item</a></li><li><a href="global.html#ITEM_SIZE">ITEM_SIZE</a></li><li><a href="global.html#MSuser">MSuser</a></li><li><a href="global.html#notificationId">notificationId</a></li><li><a href="global.html#sendData">sendData</a></li><li><a href="global.html#sendToFirestore">sendToFirestore</a></li><li><a href="global.html#showEvent">showEvent</a></li><li><a href="global.html#SPACING">SPACING</a></li><li><a href="global.html#Stack">Stack</a></li><li><a href="global.html#textPos">textPos</a></li><li><a href="global.html#today">today</a></li><li><a href="global.html#validateInput">validateInput</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Fri Oct 28 2022 15:58:33 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
