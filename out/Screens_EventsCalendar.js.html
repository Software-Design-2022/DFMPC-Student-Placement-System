<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Screens/EventsCalendar.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Screens/EventsCalendar.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState } from "react";
import {
  Button,
  StyleSheet,
  Text,
  View,
  Dimensions,
  Modal,
  TouchableHighlight,
  Image,
  TextInput,
  Alert,
  TouchableOpacity,
  Pressable,
} from "react-native";
import { Calendar } from "react-native-calendars";
import { Provider } from "react-native-paper";
import { firebase } from "../firebase";
import { getCurrentDate } from "../functions";
import BottomSheet from "./BottomSheet";
import DateTimePickerModal from "react-native-modal-datetime-picker";
import { Card, Avatar } from "react-native-paper";
import { useNavigation } from "@react-navigation/core";
import { AntDesign } from "@expo/vector-icons";
import "./global";
import { schedulePushNotification } from "./SendNotification";
import { createTopBar } from "../HelperFunctions";

const { width, height } = Dimensions.get("screen");
/**
 * Spacing between events in calendar
 */
const SPACING = 20;
/**
 * Icon size for icons on calendar
 */
const ICON_SIZE = 75;
/**
 * Current date as a string represented in the format DD-MM-YYYY
 * @type {Date}
 */
const initialDate = getCurrentDate();
/**
 * Constant to store todays date.
 */
const today = new Date();
/**
 * Compare two dates
 * @param {Date} obj1
 * @param {Date} obj2
 * @returns True if obj1 is equal to obj2, false otherwise
 */
const compare = (obj1, obj2) => {
  return JSON.stringify(obj1) === JSON.stringify(obj2);
};
/**
 * Generates a random color for event cards.
 * @returns {string} A hex color code in the format #RRGGBB
 */
const generateColor = () => {
  const randomColor = Math.floor(Math.random() * 16777215)
    .toString(16)
    .padStart(6, "0");
  return `#${randomColor}`;
};

const randomColor = generateColor();
const randomColor2 = generateColor();

/**
 * Function to get events from Firestore and add them to the onRecieveList
 * @async
 * @param {function} onRecieveList Function to add events to the calendar
 * @see https://firebase.google.com/docs/firestore/query-data/listen
 * @see https://firebase.google.com/docs/firestore/query-data/get-data
 * @returns {void} Nothing is returned. The onRecieveList function is called and the events are added to the calendar
 */
async function eventsData(onReceiveList) {
  const events = []; //Array to store events
  var snapshot = await firebase
    .firestore()
    .collection("events")
    .get()
    .then((querySnapshot) => {
      querySnapshot.forEach(function (doc) {
        let start = doc.data().start_date,
          end = doc.data().end_date,
          name = doc.data().name,
          id = doc.data().id,
          programme = doc.data().programme,
          key = events.length + 1;
        let date = new Date();
        let date2 = new Date(start);
        let diff = Math.ceil((date2 - date) / (1000 * 3600 * 24));
        if (Math.abs(diff) &lt; 90) {
          events.push({
            name: name,
            key: key,
            start: start,
            end: end,
            id: id,
            programme: programme,
          }); //Add an event to array
        }
      }); // Loop through each event in the collection
    }); //Get events from Firestore

  onReceiveList(events);
}

/**
 * Function to validate input from user when adding an event using the add event modal form
 * @param {string} eventtext Event name
 * @param {string} notetext Event description
 * @returns {boolean} True if input is valid, false otherwise
 */
const validateInput = (eventtext, notetext) => {
  let valid = true;
  if (JSON.stringify(eventtext).length - 2 &lt;= 0) {
    Alert.alert("Warning", "Event name cannot be left empty", [
      { text: "OK", onPress: () => {} },
    ]);
    valid = false;
  }

  if (JSON.stringify(notetext).length - 2 &lt;= 0) {
    Alert.alert("Warning", "Event programme cannot be left empty", [
      { text: "OK", onPress: () => {} },
    ]);
    valid = false;
  }
  return valid;
};

/**
 * Function to add an event to Firestore database. The event is validated before being added to the database.
 * @async
 * @param {string} eventtext Event name
 * @param {string} notetext Event description
 * @param {string} startdatetext Start date of event in the format DD-MM-YYYY
 * @param {string} enddatetext End date of event in the format DD-MM-YYYY
 * @returns {void} Nothing is returned. The event is added to the database and the calendar is updated.
 * @see https://firebase.google.com/docs/firestore/manage-data/add-data
 */
async function sendToFirestore(
  eventtext,
  notetext,
  startdatetext,
  enddatetext
) {
  if (validateInput(eventtext, notetext) == true) {
    await firebase
      .firestore()
      .collection("events")
      .add({
        name: eventtext,
        start_date: startdatetext,
        end_date: enddatetext,
        id: Math.max(50, Math.floor(Math.random() * 150)),
        programme: notetext,
      })
      .then(() => {
        Alert.alert("Event Added");
      });
  }
}
/**
 * React component to render the events calendar screen and its components using React Native Calendar
 * @module EventsCalendar
 * @returns {JSX.Element} JSX element to render the calendar screen
 */
const EventsCalendar = () => {
  /**
   * React hook to store the events in the calendar
   * @type {Array}
   * @see https://reactjs.org/docs/hooks-state.html
   */
  const [EventsState, SetEventsState] = useState({
    events: [
      {
        key: 0,
        programme: "",
        name: "",
        id: 0,
        start: "",
        end: "",
      },
    ],
  });

  /**
   * Object to store the events from Firestore. This is used to update the calendar when an event is added.
   * @typedef {Object} Event
   */
  /**
   * Function to add events to the calendar when they are received from Firestore
   * @type {Event}
   * @param {Event} EventsState.events Array of events to be added to the calendar
   * @returns {void} Nothing is returned. The events are added to the calendar.
   * @see https://reactjs.org/docs/hooks-state.html
   *
   */
  const onReceive = (newEvents) => {
    // when the list is received we set our protocolLIst to the current received list (updating)
    SetEventsState((prevState) => ({
      events: (prevState.events = newEvents),
    }));
  };
  eventsData(onReceive);

  const [dayData, setDayData] = useState([{}]);
  const navigation = useNavigation();

  /**
   * Function to render the event cards in the calendar when a day is selected
   *
   */
  const GetMarkedDates = () => {
    let markedDay = {};

    /**
     * Loop through each event in the calendar and add it to the markedDay object if is marked.
     * @type {Event}
     * @param {Event} EventsState.events Array of events to be compared.
     * @returns {void} Nothing is returned. The marked events are added to the markedDay object.
     */
    EventsState.events.map((item, key) => {
      if (compare(item.start, item.end)) {
        markedDay[item.start] = {
          startingDay: true,
          endingDay: true,
          selected: true,
          marked: true,
          color: randomColor2,
          dotColor: "blue",
        };
      } else {
        markedDay[item.start] = {
          startingDay: true,
          color: randomColor,
          textColor: "white",
          marked: true,
          dotColor: "black",
        };
        markedDay[item.end] = {
          endingDay: true,
          color: randomColor,
          textColor: "white",
          marked: true,
          dotColor: "black",
        };
      }
    });

    return markedDay;
  };

  const getDayEvents = (day) => {
    const data = [];
    EventsState.events.map((event, key) => {
      if (compare(event.start, day.dateString) == true) {
        data.push(event);
      }
    });
    setDayData(data);
  };

  const [eventName, setEventName] = useState("");
  const [eventProgramme, setEventProgramme] = useState("");
  const [startDate, setStartDate] = useState(
    new Date().toISOString().split("T")[0]
  );
  const [endDate, setEndDate] = useState(
    new Date().toISOString().split("T")[0]
  );
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [selectedEnd, setSelectedEnd] = useState(new Date());
  /*   const [btnstart, setBtnStart] = useState(false);
  const [btnend, setBtnEnd] = useState(false); */
  const [modalVisible, setModalVisible] = useState(false);
  const [datePickerVisible, setDatePicker] = useState(false);
  const [EnddatePickerVisible, setDatePickerEnd] = useState(false);

  return (
    &lt;View style={styles.container}>
      {createTopBar(10, navigation)}
      &lt;Modal
        style={styles.modalStyle}
        animationType={"fade"}
        transparent={true}
        visible={modalVisible}
        onRequestClose={() => {
          Alert.alert("Modal has been closed.");
          setModalVisible(false);
        }}
      >
        &lt;View style={styles.modalStyle}>
          &lt;Text
            style={{
              marginTop: 50,
              fontSize: 25,
              top: 10,
              textAlign: "center",
              color: "white",
            }}
          >
            Create Event
          &lt;/Text>
          &lt;TextInput
            style={styles.input}
            underlineColorAndroid="transparent"
            placeholder="Title"
            placeholderTextColor="white"
            autoCapitalize="none"
            onChangeText={(newText) => {
              setEventName(newText);
            }}
          />
          &lt;TextInput
            style={styles.input}
            underlineColorAndroid="transparent"
            placeholder="Program"
            placeholderTextColor="white"
            autoCapitalize="none"
            onChangeText={(newText) => {
              setEventProgramme(newText);
            }}
          />

          &lt;Pressable
            style={({ pressed }) => [
              {
                backgroundColor: pressed ? "rgb(210, 230, 255)" : "#2c477a",
              },
              {
                borderRadius: 10,
                margin: 10,
                flexDirection: "row",
                marginTop: 40,
              },
            ]}
            onPress={() => {
              setDatePicker(true);
            }}
          >
            &lt;Text style={{ margin: 30, color: "white" }}>Start&lt;/Text>
            &lt;Text
              style={{
                marginLeft: 100,
                marginBottom: 10,
                marginTop: 30,
                color: "white",
              }}
            >
              {startDate}
              {"   "}
              {"18:00"}
            &lt;/Text>
          &lt;/Pressable>

          &lt;Pressable
            style={({ pressed }) => [
              {
                backgroundColor: pressed ? "rgb(210, 230, 255)" : "#2c477a",
              },
              {
                borderRadius: 10,
                margin: 10,
                flexDirection: "row",
              },
            ]}
            onPress={() => {
              setDatePickerEnd(true);
            }}
          >
            &lt;Text style={{ margin: 30, color: "white" }}>End&lt;/Text>
            &lt;Text
              style={{
                marginLeft: 100,
                marginBottom: 10,
                marginTop: 30,
                color: "white",
              }}
            >
              {endDate}
              {"   "}
              {"18:00"}
            &lt;/Text>
          &lt;/Pressable>

          &lt;View
            style={{
              marginBottom: 10,
              flex: 1,
              display: "flex",
              justifyContent: "center",
              alignItems: "center",
            }}
          >
            &lt;DateTimePickerModal
              date={selectedDate}
              isVisible={datePickerVisible}
              mode="date"
              onConfirm={(date) => {
                setSelectedDate(date), setDatePicker(false);
                let datestr = selectedDate.toISOString().split("T")[0];
                //console.log(datestr)
                setStartDate(datestr);
              }}
              onCancel={() => {
                setDatePicker(false);
              }}
            />
            &lt;DateTimePickerModal
              date={selectedEnd}
              isVisible={EnddatePickerVisible}
              mode="date"
              onConfirm={(date) => {
                setSelectedEnd(date), setDatePickerEnd(false);

                let datestr = selectedEnd.toISOString().split("T")[0];
                //console.log(datestr)
                setEndDate(datestr);
              }}
              onCancel={() => {
                setDatePickerEnd(false);
              }}
            />
          &lt;/View>

          &lt;View style={{ flexDirection: "row" }}>
            &lt;Pressable
              style={({ pressed }) => [
                styles.button,
                styles.buttonClose,
                {
                  marginRight: 40,
                  width: width / 3,
                  left: 10,
                  bottom: 30,
                  backgroundColor: pressed
                    ? "rgba(28,56,107,1)"
                    : "rgba(0,0,0,0.5)",
                },
              ]}
              onPress={() => setModalVisible(false)}
            >
              &lt;Text
                onPress={() => setModalVisible(false)}
                style={[styles.textStyle]}
              >
                Close
              &lt;/Text>
            &lt;/Pressable>
            &lt;Pressable
              style={({ pressed }) => [
                styles.button,
                styles.buttonClose,
                {
                  width: width / 3,
                  left: 20,
                  right: 30,
                  bottom: 30,

                  backgroundColor: pressed
                    ? "rgba(28,56,107,0.3)"
                    : "rgba(128,0,0,0.5)",
                },
              ]}
              onPress={() => {
                sendToFirestore(eventName, eventProgramme, startDate, endDate);
              }}
            >
              &lt;Text style={[styles.textStyle]}>Save&lt;/Text>
            &lt;/Pressable>
          &lt;/View>
        &lt;/View>
      &lt;/Modal>

      &lt;View>
        &lt;TouchableOpacity
          onPress={() => setModalVisible(true)}
          style={{
            backgroundColor: "rgba(28,56,107,0.0)",
            position: "absolute",
            borderRadius: 50,
            width: 50,
            height: 50,
            zIndex: 1,
            right: 20,
            top: height - 220,
            alignItems: "center",
          }}
        >
          &lt;AntDesign name="pluscircle" color="black" size={50} />
        &lt;/TouchableOpacity>
      &lt;/View>
      &lt;Calendar
        style={{
          shadowColor: "black",
          height: 500,
          marginTop: 80,
          marginBottom: 30,
          marginLeft: 30,
          marginRight: 30,
        }}
        markingType={"period"}
        markedDates={GetMarkedDates()}
        onDayPress={(day) => {
          getDayEvents(day);
          eventData = dayData;
          if (showEvent == false) {
            showEvent = true;
          }
        }}
        onDayLongPress={(day) => {
          setModalVisible(true);
        }}
      />
      &lt;Provider>
        &lt;View>
          &lt;BottomSheet>&lt;/BottomSheet>
        &lt;/View>
      &lt;/Provider>
    &lt;/View>
  );
};

/**
 * Stylesheet for the events calendar
 * @type {StyleSheet}
 */
var styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "rgba(30,81,123,1)",
  },
  input: {
    margin: 15,
    height: 50,
    borderColor: "rgba(0,0,0,0.2)",
    borderWidth: 2,
    backgroundColor: "rgba(28,56,107,0.5)",
    borderRadius: 10,
  },
  button: {
    marginTop: 100,
    display: "flex",
    height: 60,
    borderRadius: 6,
    justifyContent: "center",
    alignItems: "center",
    width: "100%",
    backgroundColor: "#2AC062",
    shadowColor: "#2AC062",
    shadowOpacity: 0.5,
    shadowOffset: {
      height: 10,
      width: 0,
    },
    shadowRadius: 25,
  },
  modalStyle: {
    zIndex: 100,
    height: height - 210,
    width: width - 40,
    marginLeft: 20,
    marginRight: 10,
    marginTop: 80,
    backgroundColor: "rgba(28,56,107,1)",
    borderRadius: 25,
  },
  closeButton: {
    display: "flex",
    height: 60,
    borderRadius: 6,
    justifyContent: "center",
    alignItems: "center",
    backgroundColor: "rgba(0,0,0,0.5)",
    shadowColor: "#2AC062",
    shadowOpacity: 0.5,
    shadowOffset: {
      height: 10,
      width: 0,
    },
    shadowRadius: 25,
  },
  buttonText: {
    color: "#FFFFFF",
    fontSize: 22,
  },
  image: {
    marginTop: 150,
    marginBottom: 10,
    width: "100%",
    height: 350,
  },

  text: {
    fontSize: 24,
    marginBottom: 30,
    padding: 40,
  },
  closeText: {
    fontSize: 24,
    color: "#00479e",
    textAlign: "center",
  },

  buttonClose: {
    marginRight: 30,
    marginLeft: 10,
  },
  eventStyle: {
    justifyContent: "flex-end",
    marginBottom: 36,
    width: 50,
    height: 50,
    margin: 10,
    backgroundColor: "green",
  },
  item: {
    backgroundColor: "white",
    flex: 1,
    borderRadius: 5,
    padding: 10,
    marginRight: 10,
    marginTop: 17,
  },
  emptyDate: {
    height: 15,
    flex: 1,
    paddingTop: 30,
  },
  emptyDate: {
    height: 15,
    flex: 1,
    paddingTop: 30,
  },
  centeredView: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    marginTop: 22,
  },
  modalView: {
    margin: 20,
    backgroundColor: "white",
    borderRadius: 20,
    padding: 35,
    shadowColor: "#000",
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 5,
    width: width / 2,
    height: height / 3,
  },

  buttonClose: {
    backgroundColor: "black",
  },

  textStyle: {
    color: "white",
    fontWeight: "bold",
    textAlign: "center",
    fontSize: 20,
  },
  modalText: {
    marginBottom: 15,
    textAlign: "center",
  },
});

export default EventsCalendar;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-App%2520-%2520The%2520Main%2520App%2520Component.html">App - The Main App Component</a></li><li><a href="module-Dashboard.html">Dashboard</a></li><li><a href="module-DayAgenda.html">DayAgenda</a></li><li><a href="module-EventsCalendar.html">EventsCalendar</a></li><li><a href="module-Feedback.html">Feedback</a></li><li><a href="module-GlobalVariables%2520-%2520The%2520Global%2520Variables%2520Component.html">GlobalVariables - The Global Variables Component</a></li></ul><h3>Classes</h3><ul><li><a href="TwitterFeed.html">TwitterFeed</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AnimatedPressable">AnimatedPressable</a></li><li><a href="global.html#AnimatedTouchable">AnimatedTouchable</a></li><li><a href="global.html#authEmail">authEmail</a></li><li><a href="global.html#authLastName">authLastName</a></li><li><a href="global.html#authName">authName</a></li><li><a href="global.html#authUser">authUser</a></li><li><a href="global.html#authUserProfilePic">authUserProfilePic</a></li><li><a href="global.html#authUserRef">authUserRef</a></li><li><a href="global.html#AVATAR_SIZE">AVATAR_SIZE</a></li><li><a href="global.html#compare">compare</a></li><li><a href="global.html#DATA">DATA</a></li><li><a href="global.html#DATA2">DATA2</a></li><li><a href="global.html#defaultProfilePic">defaultProfilePic</a></li><li><a href="global.html#doctorsList">doctorsList</a></li><li><a href="global.html#eventData">eventData</a></li><li><a href="global.html#EventNotification">EventNotification</a></li><li><a href="global.html#eventsData">eventsData</a></li><li><a href="global.html#generateColor">generateColor</a></li><li><a href="global.html#ICON_SIZE">ICON_SIZE</a></li><li><a href="global.html#initialDate">initialDate</a></li><li><a href="global.html#Item">Item</a></li><li><a href="global.html#ITEM_SIZE">ITEM_SIZE</a></li><li><a href="global.html#MSuser">MSuser</a></li><li><a href="global.html#notificationId">notificationId</a></li><li><a href="global.html#sendData">sendData</a></li><li><a href="global.html#sendToFirestore">sendToFirestore</a></li><li><a href="global.html#showEvent">showEvent</a></li><li><a href="global.html#SPACING">SPACING</a></li><li><a href="global.html#Stack">Stack</a></li><li><a href="global.html#textPos">textPos</a></li><li><a href="global.html#today">today</a></li><li><a href="global.html#validateInput">validateInput</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Fri Oct 28 2022 15:52:40 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
