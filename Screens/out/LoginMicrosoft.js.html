<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: LoginMicrosoft.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: LoginMicrosoft.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react";
import MicrosoftLogin from "react-microsoft-login";
import { useNavigation } from "@react-navigation/core";
import { Button } from "react-native-web";
import "./global";
import { firebase } from "../firebase";

/**
 * @function LoginMicrosoft
 * @description This is the login screen for the application. It will allow the user to login using their Microsoft
 *            account. It will then redirect the user to the dashboard screen.
 * @returns {JSX.Element} - The login screen.
 * @constructor
 * @memberof Screens
 * @todo Add a loading screen while the user is being redirected to the dashboard screen.
 * @param {firebaseObject} data
 * @see {@link https://www.npmjs.com/package/react-microsoft-login}
 */
export function setUserVariables(data) {
  // store information about the user who is currently logged in
  authUser = data;
  console.log(data);
  authUserID = data.child("id").val();
  //authStudentNumber= authUser.child("")user_FirstName

  //global user variables to be accessed through app
  authName = authUser.child("user_FirstName").val();
  authLastName = authUser.child("user_LastName").val();
  authUserProfilePic = authUser.child("user_profile_photo/").val();
  authUserRef = firebase.database().ref("/users") + "/" + authUserID + "/";
  console.log("User ID: " + authUserID + " authenticated.");
}

export function retrieveUser() {
  firebase
    .database()
    .ref("/users")
    .on("value", (snapshot) => {
      const key = snapshot.forEach(function (data) {
        const check_email = snapshot.child(data.key + "/microsoft_email").val();

        if (check_email === authEmail) {
          // compare entered email with current email on the snapshot

          setUserVariables(data); // so that we can keep track of who is logged in currenctly
        }
      });
    });
}

export default (props) => {
  const navigation = useNavigation(); //navigation between screens

  const authHandler = (err, data) => {
    //save microsoft user data
    MSuser = data;
    console.log(MSuser.account.userName);
    //set user email to temp outlook email for database
    authEmail = "john_green_test@outlook.com";
    //once successfull navigate to dashboard
    navigation.navigate("Dashboard");
    retrieveUser();
  };
  return (
    //Microsoft button displayed for sign in
    &lt;MicrosoftLogin
      clientId={"2601b63e-4012-441c-a18d-d6d8e4cd6a29"}
      authCallback={authHandler}
    />
  );
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Screens.LoginMicrosoft.html">LoginMicrosoft</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Fri Oct 28 2022 00:06:46 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
